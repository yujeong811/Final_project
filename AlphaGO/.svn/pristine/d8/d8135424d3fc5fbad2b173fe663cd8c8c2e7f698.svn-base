<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>

<head>
<script
	src="<%=request.getContextPath()%>/resources/bootstrap/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script
	src="<%=request.getContextPath()%>/resources/bootstrap/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script
	src="<%=request.getContextPath()%>/resources/bootstrap/dist/js/adminlte.min.js"></script>
<!-- common -->
<script src="<%=request.getContextPath()%>/resources/js/common.js"></script>
<script
	src="<%=request.getContextPath()%>/resources/bootstrap/plugins/summernote/summernote-bs4.min.js"></script>

<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome Icons -->
<link rel="stylesheet"
	href="<%=request.getContextPath()%>/resources/bootstrap/plugins/fontawesome-free/css/all.min.css">
<!-- Theme style -->
<link rel="stylesheet"
	href="<%=request.getContextPath()%>/resources/bootstrap/dist/css/adminlte.min.css">
<script>
window.onload=function(){
   summernote_go($('#content'),'<%=request.getContextPath()%>');
	}
</script>

<style>
h5{
	padding-bottom: 10px;
	padding-left: 10px;
}
table tr:hover{
		background-color: #dcdcdc;
	}
</style>

</head>
<body>

	<div class="row">
			<div>
				<div class="card-header">홍보관리</div>
			</div>
	</div>
		<!-- Main content -->
		<div class="row" style="margin-top:10px;">
			<div class="col-md-6">
				<h5 style="font-weight: bold;">팝업 목록</h5>

			<div class="card" style="margin-left: 5px;">
				<div class="row" style="margin-bottom: 5px;">
					<div class="col-sm-6" style="float: right; padding: 0;">
						<select class="form-select" style="float: right; width: 30%;"
							aria-label="Default select example" name="searchType"
							id="searchType" onchange="list_go(1);">
							<option value="">전체</option>
							<option value="n">제목</option>
							<option value="r">내용</option>
						</select>
					</div>
					<div class="col-sm-6" style="float: right; padding-left: 0;">
						<!-- keyword -->
						<input class="form-control" type="text" name="keyword"
							placeholder="검색어를 입력하세요." value=""
							style="float: left; width: 75%;">
						<button class="btn btn-primary" type="button" id="searchBtn"
							style="float: right; width: 25%;" data-card-widget="search"
							onclick="list_go(1);">
							<i class="fa fa-fw fa-search"></i>
						</button>
					</div>
				</div>
				<table class="table" style="text-align: center; font-size: small;">
					<tr style="background-color: #86a8d9; color: white;">
						<th>제목</th>
						<th>등록일</th>
						<th>기간</th>
						<th>첨부파일</th>
						<th>사용상태</th>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
					<tr>
						<td>팝업제목</td>
						<td>2022/07/11</td>
						<td>2022/07/11~2022/08/11</td>
						<td><i class="uil-file-download fa-lg"> </i></td>
						<td
							style="display: flex; align-items: center; justify-content: center;">
							<button type="button" id="" class="btn btn-primary"
								style="width: 20px; height: 20px; font-size: small; display: flex; align-items: center; justify-content: center;">Y</button>
						</td>
					</tr>
				</table>
			</div>
		</div>

			<div class="col-sm-1"
				style="display: flex; justify-content: center; align-items: center;">
				<i style="font-size: 50px;" class="uil-angle-double-right"></i>
			</div>
			
			<div class="col-md-5">
				<h5 style="font-weight: bold;">팝업 등록</h5>
				<!-- form start -->
				<div class="card" style="margin-right:5px;">
					<div class="card-body">
						<form role="form" class="form-horizontal" action="regist.do"
							method="post">

							<div class="input-group mb-3">
								<div class="mailbox-attachments clearfix"
									style="text-align: center;">

								
								</div>
								<br />
							</div>
							<div class="form-group row">
								<label for="id" class="col-sm-2" style="font-size: em;">
									<span style="color: red; font-weight: bold;">*</span>제목
								</label>
								<div class="col-sm-10 input-group-sm">
									<input name="id" onkeyup="" type="text" class="form-control"
										id="id" placeholder="">

								</div>
							</div>

							<div class="form-group row">
								
								<div class="col-sm-12">
									<div class="form-group">
										<label>내용</label>
										<textarea class="form-control" rows="3"
											placeholder="내용 입력"></textarea>
									</div>
								</div>
							</div>
						
							<div class="form-group row">
								<label for="email" class="col-sm-3" style="font-size:;">
									시작일</label>
								<div class="col-sm-9 input-group-sm">
									<input name="email" type="date" class="form-control" id="email"
										placeholder="">
								</div>
							</div>
							
							<div class="form-group row">
								<label for="email" class="col-sm-3" style="font-size:;">
									마감일</label>
								<div class="col-sm-9 input-group-sm">
									<input name="email" type="date" class="form-control" id="email"
										placeholder="">
								</div>
							</div>

							<div class="form-group row">
								<label for="phone" class="col-sm-3 control-label"
									style="font-size: em;">전화번호</label>
								<div class="col-sm-9">
									<div class="input-group-sm">
										<select style="width: 75px;" name="phone" id="phone"
											class="form-control float-left">
											<option value="">-선택-</option>
											<option value="010">010</option>

										</select> <label class="float-left"
											style="padding: 0; text-align: center;">&nbsp;-&nbsp;</label>
										<input style="width: 68px;" name="phone" type="text"
											class="form-control float-left" /> <label class="float-left"
											style="padding: 0; text-align: center;">&nbsp;-</label> <input
											style="width: 68px;" name="phone" type="text"
											class="form-control float-right" />
									</div>
								</div>
							</div>
							
								
										<div class="input-group input-group-sm">
											<label for="inputFile"
												class=" btn btn-warning btn-sm btn-flat input-group-addon">파일선택</label>
											<input id="inputFileName" class="form-control" type="text"
												name="tempPicture" disabled /> <span
												class="input-group-append-sm">
												<button type="button"
													class="btn btn-primary btn-sm btn-append" onclick="">업로드</button>
											</span>
										</div>
									

							<div class="card-footer">
								<div class="row">
									<div class="col-sm-6">
										<button type="button" id="registBtn" onclick="regist_go();"
											class="btn btn-primary">등&nbsp;&nbsp;록</button>
									</div>

									<div class="col-sm-6">
										<button type="button" id="cancelBtn" onclick="CloseWindow();"
											class="btn btn-danger float-right">&nbsp;&nbsp;&nbsp;취
											&nbsp;&nbsp;소&nbsp;&nbsp;&nbsp;</button>
									</div>

								</div>
							</div>
						</form>
					</div>
					<!-- register-card-body -->
				</div>
			</div>

		</div>
		
		
		<!-- /.content -->
	<!-- /.content-wrapper -->

	<form role="imageForm" action="upload/picture" method="post"
		enctype="multipart/form-data">
		<input id="inputFile" name="pictureFile" type="file"
			class="form-control" style="display: none;" onchange="picture_go()">
		<input id="oldFile" type="hidden" name="oldPicture" value="" /> <input
			type="hidden" name="checkUpload" value="0" />
	</form>

	<!-- REQUIRED SCRIPTS -->
	<script>
		function picture_go() {
			//alert("file change");

			var form = $('form[role="imageForm"]');
			var picture = form.find('[name=pictureFile]')[0];

			//이미지 확장자 jpg 확인
			var fileFormat = picture.value.substr(
					picture.value.lastIndexOf(".") + 1).toUpperCase();
			if (!(fileFormat == "JPG" || fileFormat == "JPEG")) {
				alert("이미지는 jpg/jpeg 형식만 가능합니다.");
				picture.value = "";
				return;
			}

			//이미지 파일 용량 체크
			if (picture.files[0].size > 1024 * 1024 * 1) {
				alert("사진 용량은 1MB 이하만 가능합니다.");
				picture.value = "";
				return;
			}
			;

			//업로드 확인변수 초기화(사진변경)
			form.find('[name="checkUpload"]').val(0);

			document.getElementById('inputFileName').value = picture.files[0].name;
			//$('#inputFileName').val(picture.files[0].name)

			if (picture.files && picture.files[0]) {
				var reader = new FileReader();

				reader.onload = function(e) {
					$('div#pictureView').css({
						'background-image' : 'url(' + e.target.result + ')',
						'background-position' : 'center',
						'background-size' : 'cover',
						'background-repeat' : 'no-repeat'
					});
				}

				reader.readAsDataURL(picture.files[0]);
			}

		}

		function upload_go() {
			//alert('upload btn click')

			if (!$('input[name="pictureFile"]').val()) {
				alert('사진을 선택하세요.')
				$('input[name="pictureFile"]').click();
				return;
			}

			if ($('input[name="checkUpload"]').val() == 1) {
				alert("이미 업로드 된 사진입니다.");
				return;
			}

			var formData = new FormData($('form[role="imageForm"]')[0]);

			$.ajax({
				url : "picture.do",
				data : formData,
				type : "post",
				processData : false,
				contentType : false,
				success : function(data) {
					//업로드 확인변수 세팅
					$('input[name="checkUpload"]').val(1);
					//저장된 파일명 저장.
					$('input#oldFile').val(data);//변경시 삭제될 파일명
					$('form[role="form"] input[name="picture"]').val(data);
					alert("사진이 업로드 되었습니다.");

				},
				error : function(error) {
					alert("현재 사진 업로드가 불가합니다.\n 관리자에게 연락바랍니다.");
				}
			})

		}

		var checkedID = "";
		function idCheck_go() {
			//alert("id check btn click");

			var input_ID = $('input[name="id"]');

			if (!input_ID.val()) {
				alert("아이디를 입력하시오");
				input_ID.focus();
				return;
			}
			$.ajax({
				url : "idCheck.do?id=" + input_ID.val().trim(),
				method : "get",
				success : function(result) {
					if (result.toUpperCase() == "DUPLICATED") {
						alert("중복된 아이디 입니다.");
						$('input[name="id"]').focus();
					} else {
						alert("사용가능한 아이디 입니다.");
						checkedID = input_ID.val().trim();
						$('input[name="id"]').val(input_ID.val().trim());

					}

				},
				error : function(error) {
					alert("시스템장애로 가입이 불가합니다.");
				}

			});

		}

		function regist_go() {
			//alert("regist btn click");
			var uploadCheck = $('input[name="checkUpload"]').val();
			if (uploadCheck == "0") {
				alert("사진업로드는 필수 입니다.");
				return;
			}

			if (!$('input[name="name"]').val()) {
				alert("이름은 필수입니다.");
			}
			var form = $('form[role="form"]');
			form.attr({
				"method" : "post",
				"action" : "regist.do"
			});
			form.submit();

		}
	</script>
</body>